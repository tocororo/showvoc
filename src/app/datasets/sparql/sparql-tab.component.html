<yasgui [query]="query" (querychange)="onQueryChange($event)"></yasgui>

<!--Commands (submit, clear, inferred, ...)-->
<div class="mt-1">
    <button class="btn btn-sm btn-primary" (click)="doQuery()" [disabled]="queryInProgress || !queryValid">Submit</button>
    <button class="btn btn-sm btn-secondary ml-1" (click)="clear()" [disabled]="queryResult == null">Clear</button>
    
    <div class="form-check form-check-inline ml-3">
        <label class="form-check-label">
            <input class="form-check-input" type="checkbox" [(ngModel)]="inferred">Include Inferred
        </label>
    </div>
</div>

<!--Query result-->

<div *ngIf="queryInProgress" class="spinner-border text-info mt-1"></div>

<div *ngIf="queryResult != null" class="vbox mt-1">
    <div class="table-responsive vbox border rounded p-1">
        <table class="table table-striped table-sm table-hover" style="flex: 1">
            <thead>
                <tr>
                    <th *ngFor="let h of headers" style="white-space: nowrap">
                        {{h}}
                        <button *ngIf="resultType != 'boolean'" class="btn btn-xs btn-light" [ngSwitch]="sortOrder" (click)="sortResult(h)">
                            <span *ngSwitchCase="h+asc_Order" class="fa fa-sort-alpha-asc"></span>
                            <span *ngSwitchCase="h+desc_Order" class="fa fa-sort-alpha-desc"></span>
                            <span *ngSwitchDefault class="fa fa-sort"></span>
                        </button>
                    </th>
                </tr>
            </thead>
            <tbody style="overflow: auto;">
                <ng-template [ngIf]="resultType != 'boolean'">
                    <ng-template ngFor let-bindings [ngForOf]="queryResult" let-i="index">
                        <ng-template [ngIf]="i >= resultsPage*resultsLimit && i < resultsPage*resultsLimit + resultsLimit">
                            <tr>
                                <td *ngFor="let h of headers">
                                    <span *ngIf="bindings[h]" [ngClass]="{ clickable: isBindingResource(bindings[h]) }" (click)="onBindingClick(bindings[h])">
                                        {{getBindingShow(bindings[h])}}
                                    </span>
                                </td>
                            </tr>
                        </ng-template>
                    </ng-template>
                </ng-template>
                <ng-template [ngIf]="resultType == 'boolean'">
                    <tr>
                        <td>{{queryResult}}</td>
                    </tr>
                </ng-template>
            </tbody>
        </table>
    </div>

    <div class="d-flex mt-1" style="align-items: center">

        <div style="flex: 1; font-size: .875rem">
            <span *ngIf="resultType != 'boolean'">
                Results count: {{queryResult.length}}
            </span>
            <span *ngIf="queryTime">(Done in {{queryTime}})</span>
        </div>

        <div class="mx-2">
            <div class="btn-group btn-group-sm dropup" ngbDropdown placement="top-right">
                <button class="btn btn-light dropdown-toggle" data-toggle="dropdown" ngbDropdownToggle [disabled]="exportInProgress">
                    Save results as...
                </button>
                <div class="dropdown-menu" ngbDropdownMenu>
                    <button class="dropdown-item" style="padding: 3px 10px;" (click)="exportAsJSON()">Json</button>
                    <button class="dropdown-item" style="padding: 3px 10px;" (click)="exportAsCSV()">CSV</button>
                    <button class="dropdown-item" style="padding: 3px 10px;" (click)="exportAsTSV()">TSV</button>
                    <button class="dropdown-item" style="padding: 3px 10px;" (click)="exportAsSpradsheet('xlsx')">XLSX (Microsoft spreadsheet)</button>
                    <button class="dropdown-item" style="padding: 3px 10px;" (click)="exportAsSpradsheet('ods')">ODS (OpenDocument spreadsheet)</button>
                    <button *ngIf="resultType=='graph'" class="dropdown-item" style="padding: 3px 10px;" (click)="exportAsRdf()">RDF format...</button>
                </div>
            </div>
            <div style="width: 25px; height: 25px; display: inline-block;">
                <div *ngIf="exportInProgress" class="spinner-border spinner-border-sm text-info"></div>
            </div>
        </div>

        <div class="btn-group btn-group-sm mx-2">
            <button class="btn btn-light" title="Previous page" (click)="resultsPage=resultsPage-1" [disabled]="resultsPage==0">
                <span class="fa fa-caret-left"></span>
            </button>
            <button class="btn btn-light" style="cursor: auto" disabled>
                <span>{{resultsPage+1}} of {{resultsTotPage}}</span>
            </button>
            <button class="btn btn-light" title="Next page" (click)="resultsPage=resultsPage+1" [disabled]="resultsPage>=resultsTotPage-1">
                <span class="fa fa-caret-right"></span>
            </button>
        </div>
    </div>

</div>