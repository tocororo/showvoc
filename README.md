# README

## INTRODUCTION

There are two alternative procedures for building the PMKI portal: with Maven and with Npm.
We suggest to follow the one with Maven since it does not require npm to be installed (it is downloaded as a plugin dependency and run by Maven during the building process) and requires less interaction steps.

##	BUILDING WITH MAVEN

### Prerequisites

Maven installed.

### Building

Execute the command
```
mvn clean install
```
from the root of the project (/pmki-portal, where the pom.xml file is located). This command will generate three folders: 

*	`/node_modules`: contains the dependencies of the application;
*	`/dist/pmki-portal`: contains the static assets of the front-end;
*	`/target`: contains the generated pmki-portal-<versionnumber>.war web archive.

The directory `/dist/pmki-portal` is the distribution that contains the static assets of the front-end generated by the npm build procedure. 
This distribution can be deployed on any http server. Alternatively, the war file can be deployed on the karaf server embedded with the [Semantic Turkey](http://semanticturkey.uniroma2.it/) system (inside the `/deploy` directory) or on any application server.


##	BUILDING WITH NPM

### Prerequisites

Required [Node 10.9](https://nodejs.org/en/download) or later.
This project was generated with [Angular CLI](https://github.com/angular/angular-cli) version 7.3.0 that requires Node 10.9 or later installed. The Angular CLI requires Node 8, but development requires Node 10.

### Installing the dependencies

Execute the command below:
```
npm install  # or just: npm i
```

### Building

After having installed the dependencies, run `npm run buildprod` in order to generate a production build the project. The build artifacts will be stored in the `dist/` directory.


## DEPLOYING AND RUNNING THE SYSTEM ##

### Prerequisites ###

[Semantic Turkey](http://semanticturkey.uniroma2.it/) is necessary for the *PMKI portal* to operate. This is actually a web client for ST.


### Different Deployments

In order to run the PMKI portal it is possible to:

* deploy the war file produced through the Maven build procedure inside the `/deploy` directory of the Karaf distribution of Semantic Turkey. Then run Semantic Turkey and access the portal at `http://localhost:1979/pmki-portal`
* deploy the `pmki-portal` directory (produced by any of the two described build procedures) on any HTTP server. Run Semantic Turkey and access the portal at the address/port determined by the chosen HTTP server.
* run the portal in development mode on an *angular development server* without building (still ST must be running). After installing the dependencies (as explained above), execute the command `npm run start`. Access the portal at http://localhost:4200/. The app will automatically reload if you change any of the source files.


## FURTHER CONFIGURATION ##

In *pmkiconfis.js* (under *src/* of the source package, or under the root folder of the built distribution) it is possible to configure the *SemanticTurkey* host resolution.
By default the *PMKI portal* dynamically resolves the protocol, the IP address and the port number by using the same of its container.
In case you have installed the portal in a different container or in a dedicated server you might have to change the following configuration.
```
/**
 * IP address/logical host name of the machine hosting Semantic Turkey.
 * By default (variable left unspecified) the host is resolved dynamically by using the same address of the 
 * machine hosting PMKI.
 * Thus if PMKI and Semantic Turkey are running on the same machine this variable can be left commented,
 * otherwise uncomment the line and edit the value.
 */
// var st_host = "127.0.0.1";

/**
 * Port of the container hosting Semantic Turkey.
 * By default (variable left unspecified) the port is resolved dynamically by using the same port of the 
 * container hosting PMKI.
 * Thus if PMKI and Semantic Turkey are running on the same container this variable can be left commented,
 * otherwise uncomment the line and edit the value.
 */
// var st_port = "1979";
```
It is also possible to change the path where SemanticTurkey server is listening and the protocol to use
```
/**   
 * Path where SemanticTurkey server is listening. If omitted, the sole host is considered.
 * Please note that the path of Semantic Turkey services is defined as in:
 *  http://semanticturkey.uniroma2.it/doc/user/web_api.jsf#services_address_structure
 *  This additional path information is considered to be the starting part of the path described above, 
 *  and is usually necessary in case Semantic Turkey is installed behind a proxy redirecting the ST URL.
 */ 
var st_path;

/**
 * Protocol - either http or https.
 * By default (variable left unspecified) the protocol is resolved dynamically by using the same one of the
 * container hosting PMKI.
 */
// var st_protocol = "http";
```